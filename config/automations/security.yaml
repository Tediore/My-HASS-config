- alias: Alarm disarmed - reset things
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: alarm_control_panel.abode
    from: 'armed_away'
    to: 'disarmed'
  action:
  - service: automation.turn_off
    entity_id:
    - automation.vacation_mode_lights_on
    - automation.vacation_mode_lights_off
    - automation.vacation_mode_photo


- alias: Turn porch light on when armed home
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: alarm_control_panel.abode
    to: 'armed_home'
  - platform: time
    at: '22:00:00'
  condition:
  - condition: time
    after: '22:00:00'
    before: '05:00:00'
  - condition: state
    entity_id: alarm_control_panel.abode
    state: 'armed_home'
  action:
  - service: light.turn_on
    data:
      entity_id: light.porch_light
      kelvin: 4000
      brightness_pct: 50


- alias: Turn porch light off at sunrise
  initial_state: 'on'
  trigger:
  - platform: sun
    event: sunrise
    offset: '-00:30:00'
  action:
  - service: light.turn_off
    entity_id: light.porch_light


- alias: Activate vacation mode
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: alarm_control_panel.abode
    to: armed_away
    for: '24:00:00'
  action:
  - service: automation.turn_on
    data:
      entity_id:
      - automation.vacation_mode_lights_on
      - automation.vacation_mode_lights_off
      - automation.vacation_mode_photo


- alias: Vacation mode lights on
  trigger:
  - platform: time
    at: '21:07:17'
  condition:
    condition: state
    entity_id: alarm_control_panel.abode
    state: armed_away
  action:
  - service: hue.hue_activate_scene
    data:
      group_name: Living room
      scene_name: Sconces


- alias: Vacation mode photo
  trigger:
  - platform: time
    at: '22:00:00'
  condition:
    condition: state
    entity_id: alarm_control_panel.abode
    state: armed_away
  action:
    service: abode.trigger_quick_action
    entity_id: binary_sensor.photo


- alias: Vacation mode lights off
  trigger:
  - platform: time
    at: '22:43:21'
  condition:
    condition: state
    entity_id: alarm_control_panel.abode
    state: armed_away
  action:
  - service: light.turn_off
    entity_id: all


- alias: Turn lights on when alarm triggered
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: abode_alarm
  condition:
  - condition: state
    entity_id: alarm_control_panel.abode
    state: armed_away
  - condition: state
    entity_id: binary_sensor.dark_inside
    state: 'on'
  action:
  - service: hue.hue_activate_scene
    data:
      group_name: Living room
      scene_name: Red
  - service: hue.hue_activate_scene
    data:
      group_name: Dining room
      scene_name: Bright
  - service: hue.hue_activate_scene
    data:
      group_name: Game room
      scene_name: Red
  - service: hue.hue_activate_scene
    data:
      group_name: Master bedroom
      scene_name: Red
  - service: hue.hue_activate_scene
    data:
      group_name: Entrance
      scene_name: Read


- alias: Turn on lights when smoke or CO detected
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.zcombo_1_status
    to: 
    - 'Smoke'
    - 'CO'
  condition:
  - condition: template
    value_template: "{{ states('alarm_control_panel.abode') in ['armed_home', 'disarmed'] }}"
  action:
  - service: script.emergency


- alias: Turn lights on when leak detected
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.water_sensor_1
    - binary_sensor.water_sensor_2
    - binary_sensor.water_sensor_3
    - binary_sensor.water_sensor_4
    to: 'on'
  condition:
  - condition: state
    entity_id: alarm_control_panel.abode
    state: 'armed_home'
  action:
  - service: hue.hue_activate_scene
    data:
      group_name: Master bedroom
      scene_name: Water
  - service: hue.hue_activate_scene
    data:
      group_name: Living room
      scene_name: Water