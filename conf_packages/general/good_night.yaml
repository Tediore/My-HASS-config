script:
  good_night:
    alias: Good night
    sequence:
    - service: homeassistant.turn_on
      entity_id: 
      - input_boolean.sleep_mode
      - input_boolean.andy_sleep
      - script.lights_off_interior
      - script.christmas_lights_off
      - script.media_players_off
      - switch.bedroom_fan
      - script.transit_display_off
    - service: homeassistant.turn_off
      target:
        entity_id:
        - input_boolean.washer
        - input_boolean.dryer
        - fan.living_room
    - service: light.turn_on
      entity_id: light.main_bath_night_light
      data:
        brightness_pct: 10
    - service: light.turn_on
      entity_id: light.patio_lights
      data:
        brightness_pct: 5
    - if:
      - "{{ is_state('alarm_control_panel.home', 'disarmed') }}"
      - "{{ is_state('input_boolean.overnight_guest', 'off') }}"
      then:
      - service: alarm_control_panel.alarm_arm_night
        data:
          entity_id: alarm_control_panel.home
          code: !secret alarm_code_system
    - if:
      - "{{ is_state('switch.humidifier', 'off') }}"
      then:
      - service: switch.turn_on
        entity_id: switch.humidifier

  good_night_andy:
    sequence:
    - service: input_boolean.turn_on
      entity_id: input_boolean.andy_sleep
    - service: homeassistant.turn_off
      target:
        entity_id: light.bedroom_lamps
    - service: light.turn_on
      entity_id: light.main_bath_night_light
      data:
        brightness_pct: 10
    - if:
      - "{{ is_state('alarm_control_panel.home', 'disarmed') }}"
      - "{{ is_state('input_boolean.overnight_guest', 'off') }}"
      then:
      - service: alarm_control_panel.alarm_arm_night
        data:
          entity_id: alarm_control_panel.home
          code: !secret alarm_code_system
    - if:
      - "{{ is_state('switch.humidifier', 'off') }}"
      then:
      - service: switch.turn_on
        entity_id: switch.humidifier

  media_players_off:
    sequence:
    - service: media_player.turn_off
      entity_id: all

  lights_off_interior:
    sequence:
    - service: homeassistant.turn_off
      target:
        entity_id: group.lights_interior

  christmas_lights_off:
    sequence:
    - condition: state
      entity_id: light.christmas_lights
      state: 'on'
    - service: light.turn_off
      entity_id: light.christmas_lights

  transit_display_off:
    sequence:
    - service: rest_command.tasker
      data:
        ip_address: 10.0.4.246
        port: 1821
        path: home_assistant
        event:
                {
                'device_id':'display_off',
                'device_name':'Display Off'
              }


input_boolean:
  sleep_mode:
  andy_sleep: